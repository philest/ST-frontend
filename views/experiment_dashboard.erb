
<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" href="stylesheets/fonts.css" type="text/css" />
    <link rel="stylesheet" href="stylesheets/form.css" type="text/css" />
    <link href='http://fonts.googleapis.com/css?family=Nunito:300' rel='stylesheet' type='text/css'>
        <title>StoryTime Create Experiment Dashboard</title>

    <!-- jQuery -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>

      <script type="text/javascript">

        //start by hiding daysoptions
        $(document).ready(function() {
          $('#days_option').hide()
        })

        // hacky check to update options based on which
        // radio button is checked.            
        window.setInterval(function(){
          
          if($('#time_radio').is(':checked'))
            { $('#days_option').hide()
              $('#time_option').show()
            }
          else
            {
              $('#time_option').hide()
              $('#days_option').show()
            } 
          /// call your function here
        }, 200);

      </script>



  </head>


  <body>
    
    <h1>Create Experiment</h1>

  <form action="/form_success" method="post">
      <div>
        <label for="variable">Variable:</label>
        <div>
        <input id="time_radio" type="radio" name="variable" value='<%=ExperimentConstants::TIME_FLAG%>' checked> Time
        <br>
        <input id="days_radio" type="radio" name="variable" value='<%=ExperimentConstants::DAYS_TO_START_FLAG%>'> Days/week
        </div>
<!--          <input type="text" id="variable" name="variable"/>
 -->      </div>
      <div id="days_option">
        <label for="days_option_1">Option 1:</label>
        <select name="days_option_1">
          <option selected="selected" disabled="disabled">Select days</option>
         <option value="1">1</option>
         <option value="2">2</option>
         <option value="3">3</option>
        </select>
        
        <label for="days_option_2">Option 2:</label>
        <select name="days_option_2">
          <option selected="selected" disabled="disabled">Select days</option>
         <option value="1">1</option>
         <option value="2">2</option>
         <option value="3">3</option>
        </select>

        <label for="days_option_3">Option 2:</label>
        <select name="days_option_3">
          <option selected="selected" disabled="disabled">Select days</option>
         <option value="1">1</option>
         <option value="2">2</option>
         <option value="3">3</option>
        </select>

<!-- 


          <label for="option_1">Option 1:</label>
          <input type="text" id="option_1" />
          <label for="option_2">Option 2:</label>
          <input type="text" id="option_2"/>
          <label for="option_3">Option 3:</label>
          <input type="text" id="option_3"/>
 -->      </div>
      <div id="time_option">
        <label for="time_option_1">Option 1:</label>
        <select name="time_option_1" >
          <option selected="selected" disabled="disabled">Select time</option>
         <option value="4:0">4:00pm</option>
          <option value="4:15">4:15pm</option>
          <option value="4:30">4:30pm</option>
          <option value="4:45">4:45pm</option>
        
          <option value="5:0">5:00pm</option>
          <option value="5:15">5:15pm</option>
          <option value="5:30">5:30pm</option>
          <option value="5:45">5:45pm</option>

          <option value="6:0">6:00pm</option>
          <option value="6:15">6:15pm</option>
          <option value="6:30">6:30pm</option>
          <option value="6:45">6:45pm</option>
          
          <option value="7:0">7:00pm</option>
        </select>
        
        <label for="time_option_2">Option 2:</label>

        <select name="time_option_2">
          <option selected="selected" disabled="disabled">Select time</option>
          <option value="4:0">4:00pm</option>
          <option value="4:15">4:15pm</option>
          <option value="4:30">4:30pm</option>
          <option value="4:45">4:45pm</option>

          <option value="5:0">5:00pm</option>
          <option value="5:15">5:15pm</option>
          <option value="5:30">5:30pm</option>
          <option value="5:45">5:45pm</option>

          <option value="6:0">6:00pm</option>
          <option value="6:15">6:15pm</option>
          <option value="6:30">6:30pm</option>
          <option value="6:45">6:45pm</option>
          
          <option value="7:0">7:00pm</option>
          </select>

        <label for="time_option_3">Option 3:</label>

        <select name="time_option_3">
          <option selected="selected" disabled="disabled">Select time</option>
          <option value="4:0">4:00pm</option>
          <option value="4:15">4:15pm</option>
          <option value="4:30">4:30pm</option>
          <option value="4:45">4:45pm</option>

          <option value="5:0">5:00pm</option>
          <option value="5:15">5:15pm</option>
          <option value="5:30">5:30pm</option>
          <option value="5:45">5:45pm</option>

          <option value="6:0">6:00pm</option>
          <option value="6:15">6:15pm</option>
          <option value="6:30">6:30pm</option>
          <option value="6:45">6:45pm</option>
          
          <option value="7:0">7:00pm</option>

        </select>
      </div>


     <div id="users">
        <label for="users">Users:</label>
        <select name="users" required>
          <option selected="selected" disabled="disabled">Select users</option>
         <option value="10">10</option>
         <option value="15">15</option>
         <option value="20">20</option>
         <option value="25">25</option>
         <option value="30">30</option>
         <option value="35">35</option>
         <option value="40">40</option>
         <option value="45">45</option>
         <option value="50">50</option>
         <option value="55">55</option>
         <option value="60">60</option>
         <option value="65">65</option>
         <option value="70">70</option>
         <option value="80">80</option>
         <option value="90">90</option>
         <option value="100">100</option>
         <option value="125">125</option>
         <option value="150">150</option>
 
        </select>
    </div>

     <div id="weeks">
        <label for="weeks">Weeks:</label>
        <select name="weeks" required>
          <option selected="selected" disabled="disabled">Select Weeks</option>
         <option value="1">1</option>
         <option value="2">2</option>
         <option value="3">3</option>
         <option value="4">4</option>
         <option value="5">5</option>
         <option value="6">6</option>
         <option value="7">7</option>
         <option value="8">8</option> 
        </select>
    </div>
      <div>
          <label for="notes">Notes:</label>
          <textarea id="notes"></textarea>
      </div>


      <div class="button">
          <button id="create" type="submit">Create it!</button>
      </div>
  </form>


  <!-- Show the active and not active experiments -->
    

    <h2> There's <%= @active_experiments.count %> active experiments </h3>
    
      <% for @exper in @active_experiments %>
        <div class ="experiment">
          <h3>
              <%if @exper.variable == ExperimentConstants::TIME_FLAG%>
                 Time
              <%elsif @exper.variable == ExperimentConstants::DAYS_TO_START_FLAG%>
                 Days per Week
              <%else %>
                 Nil
              <%end%>
          </h3>
          
           <!-- get total users -->
           <% users = 0 %>
           <% for var in @exper.variations%>
              <% users = users + var.users.count%>
           <%end%>
          <h4> Users: <%= users %> </h4>

          <%if @exper.end_date && @exper.created_at%>
            <h4>Days left: <%=(@exper.end_date - @exper.created_at).to_i -  ((Time.now - @exper.created_at). / 86400).to_i%></h4>
          <%end%>

          <h4>End date: <%= @exper.end_date.to_s.split.first%></h4>


          <%if @exper.users_to_assign != nil && @exper.users_to_assign > 0%> 
            <h4> Still need <%= @exper.users_to_assign %> users.</h4>
          <%end%>

         <% for var in @exper.variations%>
            <h6> Variation: <%= var.option%> </h6>
            <h6> Users: <%= users = var.users.count%> </h6>
            <h6> Continuing: <%= cont = var.users.where("subscribed = true").count%> </h6>
            <% if var.users.count != 0 %>
             <h6>Percent Continuing: <%= cont / users * 100%> </h6>
             <%end%>

         <%end%>


       
          <%if @exper.notes %> 
            <h4> Notes: <%= @exper.notes %> </h4>
          <%end%>

        </div>
      <% end %>


    <h2> There's <%= @inactive_experiments.count %> finished experiments </h3>
      <% for @exper in @inactive_experiments %>
        <div class ="experiment">
          <h3>
              <%if @exper.variable == ExperimentConstants::TIME_FLAG%>
                 Time
              <%elsif @exper.variable == ExperimentConstants::DAYS_TO_START_FLAG%>
                 Days per Week
              <%else %>
                 Nil
              <%end%>
          </h3>
          
           <!-- get total users -->
           <% users = 0 %>
           <% for var in @exper.variations%>
              <% users = users + var.users.count%>
           <%end%>
          <h4> Users: <%= users %> </h4>
          
          <%if @exper.end_date %> 
          <h4>End date: <%= @exper.end_date.to_s.split.first%></h4>
         <%end%>

         <% for var in @exper.variations%>
            <h6> Variation: <%= var.option%> </h6>
            <h6> Users: <%= users = var.users.count%> </h6>
            <h6> Continuing: <%= cont = var.users.where("subscribed = true").count%> </h6>
            <% if var.users.count != 0 %>
             <h6>Percent Continuing: <%= cont / users * 100%> </h6>
             <%end%>

         <%end%>


       
          <%if @exper.notes %> 
            <h4> Notes: <%= @exper.notes %> </h4>
          <%end%>

        </div>
      <% end %>

    
  </body>
</html>