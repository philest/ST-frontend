<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>
  Class: TwilioHelper
  
    &mdash; StoryTime Docs
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  hasFrames = window.top.frames.main ? true : false;
  relpath = '';
  framesUrl = "frames.html#!TwilioHelper.html";
</script>


  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <div id="header">
      <div id="menu">
  
    <a href="_index.html">Index (T)</a> &raquo;
    
    
    <span class="title">TwilioHelper</span>
  

  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="class_list.html">
      Class List
    </a>
  
    <a class="full_list_link" id="method_list_link"
        href="method_list.html">
      Method List
    </a>
  
    <a class="full_list_link" id="file_list_link"
        href="file_list.html">
      File List
    </a>
  
</div>
      <div class="clear"></div>
    </div>

    <iframe id="search_frame"></iframe>

    <div id="content"><h1>Class: TwilioHelper
  
  
  
</h1>

<dl class="box">
  
    <dt class="r1">Inherits:</dt>
    <dd class="r1">
      <span class="inheritName">Object</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">TwilioHelper</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
      </dd>
    
  
  
    
  
    
  
  
  
    <dt class="r2 last">Defined in:</dt>
    <dd class="r2 last">helpers/twilio_helper.rb</dd>
  
</dl>
<div class="clear"></div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<p>Helpers for Twilio messaging and testing.</p>


  </div>
</div>
<div class="tags">
  

</div>
  <h2>Constant Summary</h2>
  
    <dl class="constants">
      
        <dt id="TEST_CRED-constant" class="">TEST_CRED =
          <div class="docstring">
  <div class="discussion">
    
<p>Run tests with Twilio test credentials.</p>


  </div>
</div>
<div class="tags">
  

</div>
        </dt>
        <dd><pre class="code"><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>test_cred</span><span class='tstring_end'>&quot;</span></span></pre></dd>
      
        <dt id="LAST-constant" class="">LAST =
          <div class="docstring">
  <div class="discussion">
    
<p>To know how long to wait between messages.</p>


  </div>
</div>
<div class="tags">
  

</div>
        </dt>
        <dd><pre class="code"><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>last</span><span class='tstring_end'>&quot;</span></span></pre></dd>
      
        <dt id="NORMAL-constant" class="">NORMAL =
          
        </dt>
        <dd><pre class="code"><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>normal</span><span class='tstring_end'>&quot;</span></span></pre></dd>
      
        <dt id="NO_WAIT-constant" class="">NO_WAIT =
          
        </dt>
        <dd><pre class="code"><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>no wait</span><span class='tstring_end'>&quot;</span></span></pre></dd>
      
        <dt id="SMS_WAIT-constant" class="">SMS_WAIT =
          <div class="docstring">
  <div class="discussion">
    
<p>Wait times for SMS and MMS between the <strong>same</strong> user.</p>


  </div>
</div>
<div class="tags">
  

</div>
        </dt>
        <dd><pre class="code"><span class='int'>12</span></pre></dd>
      
        <dt id="MMS_WAIT-constant" class="">MMS_WAIT =
          
        </dt>
        <dd><pre class="code"><span class='int'>20</span></pre></dd>
      
        <dt id="LAST_WAIT-constant" class="">LAST_WAIT =
          <div class="docstring">
  <div class="discussion">
    
<p>The wait between <strong>different</strong> users.</p>


  </div>
</div>
<div class="tags">
  

</div>
        </dt>
        <dd><pre class="code"><span class='int'>1</span></pre></dd>
      
        <dt id="MMS-constant" class="">MMS =
          
        </dt>
        <dd><pre class="code"><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>MMS</span><span class='tstring_end'>&quot;</span></span></pre></dd>
      
        <dt id="SMS-constant" class="">SMS =
          
        </dt>
        <dd><pre class="code"><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SMS</span><span class='tstring_end'>&quot;</span></span></pre></dd>
      
        <dt id="mode-classvariable" class="">@@mode =
          <div class="docstring">
  <div class="discussion">
    
<p>Current environment.</p>


  </div>
</div>
<div class="tags">
  

</div>
        </dt>
        <dd><pre class="code"><span class='const'>ENV</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>RACK_ENV</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span></pre></dd>
      
        <dt id="my_twilio_number-classvariable" class="">@@my_twilio_number =
          
        </dt>
        <dd><pre class="code"><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>+12032023505</span><span class='tstring_end'>&quot;</span></span></pre></dd>
      
    </dl>
  







  
    <h2>
      Class Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#fullRespond-class_method" title="fullRespond (class method)">+ (Object) <strong>fullRespond</strong>(body, mms_url, order) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Wrapper for SMS and MMS reply that diverts to testing or Twilio.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#fullRespondHelper-class_method" title="fullRespondHelper (class method)">+ (Object) <strong>fullRespondHelper</strong>(body, mms_url) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Twilio joint SMS - MMS response.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#fullSend-class_method" title="fullSend (class method)">+ (Object) <strong>fullSend</strong>(body, mms_url, user_phone, order) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Wrapper for new SMS + MMS sending (to testing or Twilio).</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#fullSendHelper-class_method" title="fullSendHelper (class method)">+ (Object) <strong>fullSendHelper</strong>(body, mms_url, user_phone) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Twilio send new joint SMS - MMS.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#getMMSarr-class_method" title="getMMSarr (class method)">+ (Object) <strong>getMMSarr</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Return an array of all the MMS sent.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#getSimpleSMS-class_method" title="getSimpleSMS (class method)">+ (Object) <strong>getSimpleSMS</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Return a string of the last SMS sent.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#getSMSarr-class_method" title="getSMSarr (class method)">+ (Object) <strong>getSMSarr</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Return an array of all the SMS sent.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize_testing_vars-class_method" title="initialize_testing_vars (class method)">+ (Object) <strong>initialize_testing_vars</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Refresh the testing inbox for SMS and MMS.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#mms-class_method" title="mms (class method)">+ (Object) <strong>mms</strong>(mms, user_phone) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>API to respond with a MMS.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#mmsRespond-class_method" title="mmsRespond (class method)">+ (Object) <strong>mmsRespond</strong>(mms_url) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Wrapper for MMS reply that diverts to testing or Twilio.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#mmsRespondHelper-class_method" title="mmsRespondHelper (class method)">+ (Object) <strong>mmsRespondHelper</strong>(mms_url) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Twilio MMS response.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#mmsSend-class_method" title="mmsSend (class method)">+ (Object) <strong>mmsSend</strong>(mms_url, user_phone) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Wrapper for new MMS sending (to testing or Twilio).</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#mmsSendHelper-class_method" title="mmsSendHelper (class method)">+ (Object) <strong>mmsSendHelper</strong>(mms_url, user_phone) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Twilio send new MMS.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#new_mms-class_method" title="new_mms (class method)">+ (Object) <strong>new_mms</strong>(sms, mms_array, user_phone) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Send new MMS (async).</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#new_sprint_long_sms-class_method" title="new_sprint_long_sms (class method)">+ (Object) <strong>new_sprint_long_sms</strong>(long_sms, user_phone) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Send new Sprint texts (asynchonously).</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#new_text-class_method" title="new_text (class method)">+ (Object) <strong>new_text</strong>(normalSMS, sprintSMS, user_phone) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Send new SMS (async).</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#new_text_no_wait-class_method" title="new_text_no_wait (class method)">+ (Object) <strong>new_text_no_wait</strong>(normalSMS, sprintSMS, user_phone) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Sends a new text without sleeping.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#smsRespond-class_method" title="smsRespond (class method)">+ (Object) <strong>smsRespond</strong>(body, order) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Wrapper for SMS reply that diverts to testing or Twilio.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#smsRespondHelper-class_method" title="smsRespondHelper (class method)">+ (Object) <strong>smsRespondHelper</strong>(body) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Twilio SMS response.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#smsSend-class_method" title="smsSend (class method)">+ (Object) <strong>smsSend</strong>(body, user_phone) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Wrapper for new SMS sending (to testing or Twilio).</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#smsSendHelper-class_method" title="smsSendHelper (class method)">+ (Object) <strong>smsSendHelper</strong>(body, user_phone) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Twilio send new SMS.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#testCred-class_method" title="testCred (class method)">+ (Object) <strong>testCred</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Configure and turn on test credentials for higher-fidelity testing.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#testCredOff-class_method" title="testCredOff (class method)">+ (Object) <strong>testCredOff</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Turn off test credentials.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#text-class_method" title="text (class method)">+ (Object) <strong>text</strong>(normalSMS, sprintSMS, user_phone) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>API to respond with an SMS.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#text_and_mms-class_method" title="text_and_mms (class method)">+ (Object) <strong>text_and_mms</strong>(body, mms_url, user_phone) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>API to respond with a joint SMS - MMS.</p>
</div></span>
  
</li>

      
    </ul>
  



  <div id="class_method_details" class="method_details_list">
    <h2>Class Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="fullRespond-class_method">
  
    + (<tt>Object</tt>) <strong>fullRespond</strong>(body, mms_url, order) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Wrapper for SMS and MMS reply that diverts to testing or Twilio.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


129
130
131
132
133
134
135
136
137
138
139
140
141
142</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'helpers/twilio_helper.rb', line 129</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_fullRespond'>fullRespond</span><span class='lparen'>(</span><span class='id identifier rubyid_body'>body</span><span class='comma'>,</span> <span class='id identifier rubyid_mms_url'>mms_url</span><span class='comma'>,</span> <span class='id identifier rubyid_order'>order</span><span class='rparen'>)</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_mms_url'>mms_url</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span> <span class='op'>==</span> <span class='const'>Array</span>
    <span class='id identifier rubyid_mms_url'>mms_url</span> <span class='op'>=</span> <span class='id identifier rubyid_mms_url'>mms_url</span><span class='period'>.</span><span class='id identifier rubyid_shift'>shift</span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='cvar'>@@mode</span> <span class='op'>==</span> <span class='const'>TEST</span> <span class='op'>||</span> <span class='cvar'>@@mode</span> <span class='op'>==</span> <span class='const'>TEST_CRED</span>
   <span class='cvar'>@@twiml_mms</span><span class='period'>.</span><span class='id identifier rubyid_push'>push</span> <span class='id identifier rubyid_mms_url'>mms_url</span>
   <span class='cvar'>@@twiml_sms</span><span class='period'>.</span><span class='id identifier rubyid_push'>push</span> <span class='id identifier rubyid_body'>body</span>
  <span class='kw'>elsif</span> <span class='cvar'>@@mode</span> <span class='op'>==</span> <span class='const'>PRO</span>
    <span class='const'>TwilioHelper</span><span class='period'>.</span><span class='id identifier rubyid_fullRespondHelper'>fullRespondHelper</span><span class='lparen'>(</span><span class='id identifier rubyid_body'>body</span><span class='comma'>,</span> <span class='id identifier rubyid_mms_url'>mms_url</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="fullRespondHelper-class_method">
  
    + (<tt>Object</tt>) <strong>fullRespondHelper</strong>(body, mms_url) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Twilio joint SMS - MMS response.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


206
207
208
209
210
211
212
213
214</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'helpers/twilio_helper.rb', line 206</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_fullRespondHelper'>fullRespondHelper</span><span class='lparen'>(</span><span class='id identifier rubyid_body'>body</span><span class='comma'>,</span> <span class='id identifier rubyid_mms_url'>mms_url</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_twiml'>twiml</span> <span class='op'>=</span> <span class='const'>Twilio</span><span class='op'>::</span><span class='const'>TwiML</span><span class='op'>::</span><span class='const'>Response</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_r'>r</span><span class='op'>|</span>
      <span class='id identifier rubyid_r'>r</span><span class='period'>.</span><span class='const'>Message</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_m'>m</span><span class='op'>|</span>
        <span class='id identifier rubyid_m'>m</span><span class='period'>.</span><span class='const'>Media</span> <span class='id identifier rubyid_mms_url'>mms_url</span>
        <span class='id identifier rubyid_m'>m</span><span class='period'>.</span><span class='const'>Body</span> <span class='id identifier rubyid_body'>body</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_twiml'>twiml</span><span class='period'>.</span><span class='id identifier rubyid_text'>text</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="fullSend-class_method">
  
    + (<tt>Object</tt>) <strong>fullSend</strong>(body, mms_url, user_phone, order) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Wrapper for new SMS + MMS sending (to testing or Twilio)</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


172
173
174
175
176
177
178
179</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'helpers/twilio_helper.rb', line 172</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_fullSend'>fullSend</span><span class='lparen'>(</span><span class='id identifier rubyid_body'>body</span><span class='comma'>,</span> <span class='id identifier rubyid_mms_url'>mms_url</span><span class='comma'>,</span> <span class='id identifier rubyid_user_phone'>user_phone</span><span class='comma'>,</span> <span class='id identifier rubyid_order'>order</span><span class='rparen'>)</span>
<span class='comment'>#account for mms_url in arrays
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_mms_url'>mms_url</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span> <span class='op'>==</span> <span class='const'>Array</span>
    <span class='id identifier rubyid_mms_url'>mms_url</span> <span class='op'>=</span> <span class='id identifier rubyid_mms_url'>mms_url</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span>
  <span class='kw'>end</span>

  <span class='const'>TwilioHelper</span><span class='period'>.</span><span class='id identifier rubyid_fullSendHelper'>fullSendHelper</span><span class='lparen'>(</span><span class='id identifier rubyid_body'>body</span><span class='comma'>,</span> <span class='id identifier rubyid_mms_url'>mms_url</span><span class='comma'>,</span> <span class='id identifier rubyid_user_phone'>user_phone</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="fullSendHelper-class_method">
  
    + (<tt>Object</tt>) <strong>fullSendHelper</strong>(body, mms_url, user_phone) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Twilio send new joint SMS - MMS.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'helpers/twilio_helper.rb', line 263</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_fullSendHelper'>fullSendHelper</span><span class='lparen'>(</span><span class='id identifier rubyid_body'>body</span><span class='comma'>,</span> <span class='id identifier rubyid_mms_url'>mms_url</span><span class='comma'>,</span> <span class='id identifier rubyid_user_phone'>user_phone</span><span class='rparen'>)</span>
  
<span class='kw'>if</span> <span class='cvar'>@@mode</span> <span class='op'>==</span> <span class='const'>PRO</span>
    <span class='id identifier rubyid_account_sid'>account_sid</span> <span class='op'>=</span> <span class='const'>ENV</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>TW_ACCOUNT_SID</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_auth_token'>auth_token</span> <span class='op'>=</span> <span class='const'>ENV</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>TW_AUTH_TOKEN</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
  <span class='ivar'>@client</span> <span class='op'>=</span> <span class='const'>Twilio</span><span class='op'>::</span><span class='const'>REST</span><span class='op'>::</span><span class='const'>Client</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span> <span class='id identifier rubyid_account_sid'>account_sid</span><span class='comma'>,</span> <span class='id identifier rubyid_auth_token'>auth_token</span>
<span class='kw'>end</span>
      
<span class='comment'>#get user
</span><span class='ivar'>@user</span> <span class='op'>=</span> <span class='const'>User</span><span class='period'>.</span><span class='id identifier rubyid_find_by_phone'>find_by_phone</span><span class='lparen'>(</span><span class='id identifier rubyid_user_phone'>user_phone</span><span class='rparen'>)</span>

<span class='comment'>#chop up if a long message to a sprint user.
</span><span class='kw'>if</span> <span class='id identifier rubyid_body'>body</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span> <span class='op'>&gt;=</span> <span class='int'>160</span> <span class='op'>&amp;&amp;</span> <span class='ivar'>@user</span><span class='period'>.</span><span class='id identifier rubyid_carrier'>carrier</span> <span class='op'>==</span> <span class='const'>Text</span><span class='op'>::</span><span class='const'>SPRINT</span> 
    
  <span class='id identifier rubyid_sprint_arr'>sprint_arr</span> <span class='op'>=</span> <span class='const'>Sprint</span><span class='period'>.</span><span class='id identifier rubyid_chop'>chop</span><span class='lparen'>(</span><span class='id identifier rubyid_body'>body</span><span class='rparen'>)</span>

  <span class='kw'>if</span> <span class='cvar'>@@mode</span> <span class='op'>==</span> <span class='const'>TEST</span> <span class='op'>||</span>
       <span class='cvar'>@@mode</span> <span class='op'>==</span> <span class='const'>TEST_CRED</span>
    <span class='cvar'>@@twiml_mms</span><span class='period'>.</span><span class='id identifier rubyid_push'>push</span> <span class='id identifier rubyid_mms_url'>mms_url</span>
    <span class='cvar'>@@twiml_sms</span><span class='period'>.</span><span class='id identifier rubyid_push'>push</span> <span class='id identifier rubyid_sprint_arr'>sprint_arr</span><span class='period'>.</span><span class='id identifier rubyid_shift'>shift</span> <span class='comment'>#add first part
</span>  <span class='kw'>else</span>

  <span class='comment'>#send mms with first part of sms series
</span>  <span class='ivar'>@client</span><span class='period'>.</span><span class='id identifier rubyid_account'>account</span><span class='period'>.</span><span class='id identifier rubyid_messages'>messages</span><span class='period'>.</span><span class='id identifier rubyid_create'>create</span><span class='lparen'>(</span>
        <span class='symbol'>:media_url</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_mms_url'>mms_url</span><span class='comma'>,</span>
        <span class='symbol'>:body</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_sprint_arr'>sprint_arr</span><span class='period'>.</span><span class='id identifier rubyid_shift'>shift</span><span class='comma'>,</span>
        <span class='symbol'>:to</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_user_phone'>user_phone</span><span class='comma'>,</span>    
        <span class='symbol'>:from</span> <span class='op'>=&gt;</span> <span class='cvar'>@@my_twilio_number</span><span class='rparen'>)</span>

  <span class='kw'>end</span> 

  <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Sent </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_mms_url'>mms_url</span><span class='lbracket'>[</span><span class='op'>-</span><span class='int'>10</span><span class='op'>..</span><span class='op'>-</span><span class='int'>5</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_content'> and sms part 1</span><span class='tstring_end'>&quot;</span></span>

  <span class='comment'>#send the rest of sms series
</span>        <span class='const'>NewTextWorker</span><span class='period'>.</span><span class='id identifier rubyid_perform_in'>perform_in</span><span class='lparen'>(</span><span class='const'>MMS_WAIT</span><span class='period'>.</span><span class='id identifier rubyid_seconds'>seconds</span><span class='comma'>,</span> <span class='id identifier rubyid_sprint_arr'>sprint_arr</span><span class='comma'>,</span> <span class='const'>NewTextWorker</span><span class='op'>::</span><span class='const'>NOT_STORY</span><span class='comma'>,</span> <span class='id identifier rubyid_user_phone'>user_phone</span><span class='rparen'>)</span>

    <span class='kw'>else</span> <span class='comment'>#not long-sprint
</span>
  <span class='kw'>if</span> <span class='cvar'>@@mode</span> <span class='op'>==</span> <span class='const'>TEST</span> <span class='op'>||</span> <span class='cvar'>@@mode</span> <span class='op'>==</span> <span class='const'>TEST_CRED</span>
    <span class='cvar'>@@twiml_mms</span><span class='period'>.</span><span class='id identifier rubyid_push'>push</span> <span class='id identifier rubyid_mms_url'>mms_url</span>
    <span class='cvar'>@@twiml_sms</span><span class='period'>.</span><span class='id identifier rubyid_push'>push</span> <span class='id identifier rubyid_body'>body</span>
    <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Sent </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_mms_url'>mms_url</span><span class='lbracket'>[</span><span class='op'>-</span><span class='int'>10</span><span class='op'>..</span><span class='op'>-</span><span class='int'>5</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_content'>, </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_body'>body</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>

      <span class='kw'>else</span>
         <span class='id identifier rubyid_message'>message</span> <span class='op'>=</span> <span class='ivar'>@client</span><span class='period'>.</span><span class='id identifier rubyid_account'>account</span><span class='period'>.</span><span class='id identifier rubyid_messages'>messages</span><span class='period'>.</span><span class='id identifier rubyid_create'>create</span><span class='lparen'>(</span>
          <span class='symbol'>:body</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_body'>body</span><span class='comma'>,</span>
          <span class='symbol'>:media_url</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_mms_url'>mms_url</span><span class='comma'>,</span>
          <span class='symbol'>:to</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_user_phone'>user_phone</span><span class='comma'>,</span>     <span class='comment'># Replace with your phone number
</span>          <span class='symbol'>:from</span> <span class='op'>=&gt;</span> <span class='cvar'>@@my_twilio_number</span><span class='rparen'>)</span>   <span class='comment'># Replace with your Twilio number
</span>  <span class='kw'>end</span>

<span class='kw'>end</span>

    <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Sent mms to </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_user_phone'>user_phone</span><span class='embexpr_end'>}</span><span class='tstring_content'>: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_mms_url'>mms_url</span><span class='lbracket'>[</span><span class='op'>-</span><span class='int'>10</span><span class='op'>..</span><span class='op'>-</span><span class='int'>5</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>along with sms: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_body'>body</span><span class='lbracket'>[</span><span class='int'>10</span><span class='comma'>,</span> <span class='int'>18</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> 

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="getMMSarr-class_method">
  
    + (<tt>Object</tt>) <strong>getMMSarr</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Return an array of all the MMS sent.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


66
67
68</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'helpers/twilio_helper.rb', line 66</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_getMMSarr'>getMMSarr</span>
  <span class='kw'>return</span> <span class='cvar'>@@twiml_mms</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="getSimpleSMS-class_method">
  
    + (<tt>Object</tt>) <strong>getSimpleSMS</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Return a string of the last SMS sent.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


56
57
58</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'helpers/twilio_helper.rb', line 56</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_getSimpleSMS'>getSimpleSMS</span>
  <span class='kw'>return</span> <span class='cvar'>@@twiml</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="getSMSarr-class_method">
  
    + (<tt>Object</tt>) <strong>getSMSarr</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Return an array of all the SMS sent.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


61
62
63</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'helpers/twilio_helper.rb', line 61</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_getSMSarr'>getSMSarr</span>
  <span class='kw'>return</span> <span class='cvar'>@@twiml_sms</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="initialize_testing_vars-class_method">
  
    + (<tt>Object</tt>) <strong>initialize_testing_vars</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Refresh the testing inbox for SMS and MMS</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


49
50
51
52
53</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'helpers/twilio_helper.rb', line 49</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_initialize_testing_vars'>initialize_testing_vars</span>
  <span class='cvar'>@@twiml_sms</span> <span class='op'>=</span> <span class='const'>Array</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
  <span class='cvar'>@@twiml_mms</span> <span class='op'>=</span> <span class='const'>Array</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
  <span class='cvar'>@@twiml</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="mms-class_method">
  
    + (<tt>Object</tt>) <strong>mms</strong>(mms, user_phone) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>API to respond with a MMS</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


347
348
349
350
351
352
353
354
355
356
357
358
359</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'helpers/twilio_helper.rb', line 347</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_mms'>mms</span><span class='lparen'>(</span><span class='id identifier rubyid_mms'>mms</span><span class='comma'>,</span> <span class='id identifier rubyid_user_phone'>user_phone</span><span class='rparen'>)</span>
     
  
  <span class='kw'>if</span> <span class='lparen'>(</span><span class='id identifier rubyid_user'>user</span> <span class='op'>=</span> <span class='const'>User</span><span class='period'>.</span><span class='id identifier rubyid_find_by'>find_by</span><span class='lparen'>(</span><span class='label'>phone:</span> <span class='id identifier rubyid_user_phone'>user_phone</span><span class='rparen'>)</span><span class='rparen'>)</span> <span class='op'>==</span> <span class='kw'>nil</span>
      <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Sent mms to new user</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Sent to </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_user'>user</span><span class='period'>.</span><span class='id identifier rubyid_phone'>phone</span><span class='embexpr_end'>}</span><span class='tstring_content'>: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_mms'>mms</span><span class='lbracket'>[</span><span class='op'>-</span><span class='int'>10</span><span class='op'>..</span><span class='op'>-</span><span class='int'>5</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> 
    <span class='kw'>end</span>


    <span class='const'>TwilioHelper</span><span class='period'>.</span><span class='id identifier rubyid_mmsRespond'>mmsRespond</span><span class='lparen'>(</span><span class='id identifier rubyid_mms'>mms</span><span class='rparen'>)</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="mmsRespond-class_method">
  
    + (<tt>Object</tt>) <strong>mmsRespond</strong>(mms_url) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Wrapper for MMS reply that diverts to testing or Twilio.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


116
117
118
119
120
121
122
123
124</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'helpers/twilio_helper.rb', line 116</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_mmsRespond'>mmsRespond</span><span class='lparen'>(</span><span class='id identifier rubyid_mms_url'>mms_url</span><span class='rparen'>)</span>

  <span class='kw'>if</span> <span class='cvar'>@@mode</span> <span class='op'>==</span> <span class='const'>TEST</span> <span class='op'>||</span> <span class='cvar'>@@mode</span> <span class='op'>==</span> <span class='const'>TEST_CRED</span>
    <span class='cvar'>@@twiml_mms</span><span class='period'>.</span><span class='id identifier rubyid_push'>push</span> <span class='id identifier rubyid_mms_url'>mms_url</span>
  <span class='kw'>elsif</span> <span class='cvar'>@@mode</span> <span class='op'>==</span> <span class='const'>PRO</span>
    <span class='const'>TwilioHelper</span><span class='period'>.</span><span class='id identifier rubyid_mmsRespondHelper'>mmsRespondHelper</span><span class='lparen'>(</span><span class='id identifier rubyid_mms_url'>mms_url</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="mmsRespondHelper-class_method">
  
    + (<tt>Object</tt>) <strong>mmsRespondHelper</strong>(mms_url) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Twilio MMS response.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


195
196
197
198
199
200
201
202</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'helpers/twilio_helper.rb', line 195</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_mmsRespondHelper'>mmsRespondHelper</span><span class='lparen'>(</span><span class='id identifier rubyid_mms_url'>mms_url</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_twiml'>twiml</span> <span class='op'>=</span> <span class='const'>Twilio</span><span class='op'>::</span><span class='const'>TwiML</span><span class='op'>::</span><span class='const'>Response</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_r'>r</span><span class='op'>|</span>
      <span class='id identifier rubyid_r'>r</span><span class='period'>.</span><span class='const'>Message</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_m'>m</span><span class='op'>|</span>
        <span class='id identifier rubyid_m'>m</span><span class='period'>.</span><span class='const'>Media</span> <span class='id identifier rubyid_mms_url'>mms_url</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_twiml'>twiml</span><span class='period'>.</span><span class='id identifier rubyid_text'>text</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="mmsSend-class_method">
  
    + (<tt>Object</tt>) <strong>mmsSend</strong>(mms_url, user_phone) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Wrapper for new MMS sending (to testing or Twilio)</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


161
162
163
164
165
166
167
168</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'helpers/twilio_helper.rb', line 161</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_mmsSend'>mmsSend</span><span class='lparen'>(</span><span class='id identifier rubyid_mms_url'>mms_url</span><span class='comma'>,</span> <span class='id identifier rubyid_user_phone'>user_phone</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='cvar'>@@mode</span> <span class='op'>==</span> <span class='const'>TEST</span> <span class='op'>||</span> <span class='cvar'>@@mode</span> <span class='op'>==</span> <span class='const'>TEST_CRED</span>
    <span class='cvar'>@@twiml_mms</span><span class='period'>.</span><span class='id identifier rubyid_push'>push</span> <span class='id identifier rubyid_mms_url'>mms_url</span>
    <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Sent </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_mms_url'>mms_url</span><span class='lbracket'>[</span><span class='op'>-</span><span class='int'>10</span><span class='op'>..</span><span class='op'>-</span><span class='int'>5</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>elsif</span> <span class='cvar'>@@mode</span> <span class='op'>==</span> <span class='const'>PRO</span>
    <span class='const'>TwilioHelper</span><span class='period'>.</span><span class='id identifier rubyid_mmsSendHelper'>mmsSendHelper</span><span class='lparen'>(</span><span class='id identifier rubyid_mms_url'>mms_url</span><span class='comma'>,</span> <span class='id identifier rubyid_user_phone'>user_phone</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="mmsSendHelper-class_method">
  
    + (<tt>Object</tt>) <strong>mmsSendHelper</strong>(mms_url, user_phone) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Twilio send new MMS.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


245
246
247
248
249
250
251
252
253
254
255
256
257
258
259</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'helpers/twilio_helper.rb', line 245</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_mmsSendHelper'>mmsSendHelper</span><span class='lparen'>(</span><span class='id identifier rubyid_mms_url'>mms_url</span><span class='comma'>,</span> <span class='id identifier rubyid_user_phone'>user_phone</span><span class='rparen'>)</span>
    
  <span class='kw'>if</span> <span class='cvar'>@@mode</span> <span class='op'>==</span> <span class='const'>PRO</span>
      <span class='id identifier rubyid_account_sid'>account_sid</span> <span class='op'>=</span> <span class='const'>ENV</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>TW_ACCOUNT_SID</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_auth_token'>auth_token</span> <span class='op'>=</span> <span class='const'>ENV</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>TW_AUTH_TOKEN</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
    <span class='ivar'>@client</span> <span class='op'>=</span> <span class='const'>Twilio</span><span class='op'>::</span><span class='const'>REST</span><span class='op'>::</span><span class='const'>Client</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span> <span class='id identifier rubyid_account_sid'>account_sid</span><span class='comma'>,</span> <span class='id identifier rubyid_auth_token'>auth_token</span>
  <span class='kw'>end</span>

  <span class='ivar'>@client</span><span class='period'>.</span><span class='id identifier rubyid_account'>account</span><span class='period'>.</span><span class='id identifier rubyid_messages'>messages</span><span class='period'>.</span><span class='id identifier rubyid_create'>create</span><span class='lparen'>(</span>
    <span class='symbol'>:media_url</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_mms_url'>mms_url</span><span class='comma'>,</span>
    <span class='symbol'>:to</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_user_phone'>user_phone</span><span class='comma'>,</span>     <span class='comment'># Replace with your phone number
</span>    <span class='symbol'>:from</span> <span class='op'>=&gt;</span> <span class='cvar'>@@my_twilio_number</span><span class='rparen'>)</span>   <span class='comment'># Replace with your Twilio number
</span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Sent mms to </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_user_phone'>user_phone</span><span class='embexpr_end'>}</span><span class='tstring_content'>: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_mms_url'>mms_url</span><span class='lbracket'>[</span><span class='op'>-</span><span class='int'>10</span><span class='op'>..</span><span class='op'>-</span><span class='int'>5</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="new_mms-class_method">
  
    + (<tt>Object</tt>) <strong>new_mms</strong>(sms, mms_array, user_phone) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Send new MMS (async).</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


422
423
424
425
426
427
428
429
430
431
432
433
434
435
436
437
438
439
440
441
442
443
444
445
446
447
448
449
450
451
452
453
454
455
456
457
458
459</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'helpers/twilio_helper.rb', line 422</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_new_mms'>new_mms</span><span class='lparen'>(</span><span class='id identifier rubyid_sms'>sms</span><span class='comma'>,</span> <span class='id identifier rubyid_mms_array'>mms_array</span><span class='comma'>,</span> <span class='id identifier rubyid_user_phone'>user_phone</span><span class='rparen'>)</span>
  <span class='ivar'>@user</span> <span class='op'>=</span> <span class='const'>User</span><span class='period'>.</span><span class='id identifier rubyid_find_by'>find_by</span><span class='lparen'>(</span><span class='label'>phone:</span> <span class='id identifier rubyid_user_phone'>user_phone</span><span class='rparen'>)</span>

  <span class='comment'>##account for single mms as string
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_mms_array'>mms_array</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span> <span class='op'>==</span> <span class='const'>String</span>
    <span class='id identifier rubyid_mms_array'>mms_array</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='id identifier rubyid_mms_array'>mms_array</span><span class='rbracket'>]</span>
  <span class='kw'>end</span>

  <span class='comment'>#if long sprint mms + sms, send all images, then texts one-by-one
</span>  <span class='kw'>if</span> <span class='ivar'>@user</span> <span class='op'>!=</span> <span class='kw'>nil</span> <span class='op'>&amp;&amp;</span> <span class='lparen'>(</span><span class='ivar'>@user</span><span class='period'>.</span><span class='id identifier rubyid_carrier'>carrier</span> <span class='op'>==</span> <span class='const'>Text</span><span class='op'>::</span><span class='const'>SPRINT</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_sms'>sms</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span> <span class='op'>&gt;</span> <span class='int'>160</span><span class='rparen'>)</span>

    <span class='id identifier rubyid_mms_array'>mms_array</span><span class='period'>.</span><span class='id identifier rubyid_each_with_index'>each_with_index</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_mms_url'>mms_url</span><span class='comma'>,</span> <span class='id identifier rubyid_index'>index</span><span class='op'>|</span>
        
        <span class='const'>TwilioHelper</span><span class='period'>.</span><span class='id identifier rubyid_mmsSend'>mmsSend</span><span class='lparen'>(</span><span class='id identifier rubyid_mms_url'>mms_url</span><span class='comma'>,</span> <span class='id identifier rubyid_user_phone'>user_phone</span><span class='rparen'>)</span>
           <span class='comment'>#for all, because text follows
</span>    <span class='kw'>end</span>

    <span class='const'>TwilioHelper</span><span class='period'>.</span><span class='id identifier rubyid_new_sprint_long_sms'>new_sprint_long_sms</span><span class='lparen'>(</span><span class='id identifier rubyid_sms'>sms</span><span class='comma'>,</span> <span class='id identifier rubyid_user_phone'>user_phone</span><span class='rparen'>)</span>

  <span class='kw'>else</span>

    <span class='id identifier rubyid_mms_array'>mms_array</span><span class='period'>.</span><span class='id identifier rubyid_each_with_index'>each_with_index</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_mms'>mms</span><span class='comma'>,</span> <span class='id identifier rubyid_index'>index</span><span class='op'>|</span>

      <span class='kw'>if</span> <span class='id identifier rubyid_index'>index</span> <span class='op'>+</span> <span class='int'>1</span> <span class='op'>==</span> <span class='id identifier rubyid_mms_array'>mms_array</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span> <span class='comment'>#last image comes w/ SMS
</span>      
        <span class='const'>TwilioHelper</span><span class='period'>.</span><span class='id identifier rubyid_fullSend'>fullSend</span><span class='lparen'>(</span><span class='id identifier rubyid_sms'>sms</span><span class='comma'>,</span> <span class='id identifier rubyid_mms'>mms</span><span class='comma'>,</span> <span class='id identifier rubyid_user_phone'>user_phone</span><span class='comma'>,</span> <span class='const'>LAST</span><span class='rparen'>)</span>

      <span class='kw'>else</span>

        <span class='const'>TwilioHelper</span><span class='period'>.</span><span class='id identifier rubyid_mmsSend'>mmsSend</span><span class='lparen'>(</span><span class='id identifier rubyid_mms'>mms</span><span class='comma'>,</span> <span class='id identifier rubyid_user_phone'>user_phone</span><span class='rparen'>)</span>

      <span class='kw'>end</span>

    <span class='kw'>end</span>

  <span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="new_sprint_long_sms-class_method">
  
    + (<tt>Object</tt>) <strong>new_sprint_long_sms</strong>(long_sms, user_phone) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Send new Sprint texts (asynchonously).</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


408
409
410
411
412
413
414
415
416
417
418
419</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'helpers/twilio_helper.rb', line 408</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_new_sprint_long_sms'>new_sprint_long_sms</span><span class='lparen'>(</span><span class='id identifier rubyid_long_sms'>long_sms</span><span class='comma'>,</span> <span class='id identifier rubyid_user_phone'>user_phone</span><span class='rparen'>)</span>
  <span class='ivar'>@user</span> <span class='op'>=</span> <span class='const'>User</span><span class='period'>.</span><span class='id identifier rubyid_find_by'>find_by</span><span class='lparen'>(</span><span class='label'>phone:</span> <span class='id identifier rubyid_user_phone'>user_phone</span><span class='rparen'>)</span>

  <span class='comment'>#find if it&#39;s first story or not
</span>  <span class='kw'>if</span> <span class='ivar'>@user</span><span class='period'>.</span><span class='id identifier rubyid_total_messages'>total_messages</span> <span class='op'>&lt;</span> <span class='int'>1</span>
    <span class='id identifier rubyid_type'>type</span> <span class='op'>=</span> <span class='const'>NewTextWorker</span><span class='op'>::</span><span class='const'>STORY</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_type'>type</span> <span class='op'>=</span> <span class='const'>NewTextWorker</span><span class='op'>::</span><span class='const'>NOT_STORY</span>
  <span class='kw'>end</span>

  <span class='const'>NewTextWorker</span><span class='period'>.</span><span class='id identifier rubyid_perform_async'>perform_async</span><span class='lparen'>(</span><span class='id identifier rubyid_long_sms'>long_sms</span><span class='comma'>,</span> <span class='id identifier rubyid_type'>type</span><span class='comma'>,</span> <span class='id identifier rubyid_user_phone'>user_phone</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="new_text-class_method">
  
    + (<tt>Object</tt>) <strong>new_text</strong>(normalSMS, sprintSMS, user_phone) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Send new SMS (async).</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


463
464
465
466
467
468
469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'helpers/twilio_helper.rb', line 463</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_new_text'>new_text</span><span class='lparen'>(</span><span class='id identifier rubyid_normalSMS'>normalSMS</span><span class='comma'>,</span> <span class='id identifier rubyid_sprintSMS'>sprintSMS</span><span class='comma'>,</span> <span class='id identifier rubyid_user_phone'>user_phone</span><span class='rparen'>)</span>
  
  <span class='ivar'>@user</span> <span class='op'>=</span> <span class='const'>User</span><span class='period'>.</span><span class='id identifier rubyid_find_by'>find_by</span><span class='lparen'>(</span><span class='label'>phone:</span> <span class='id identifier rubyid_user_phone'>user_phone</span><span class='rparen'>)</span>

  <span class='comment'>#if sprint
</span>  <span class='kw'>if</span> <span class='lparen'>(</span><span class='ivar'>@user</span> <span class='op'>==</span> <span class='kw'>nil</span> <span class='op'>||</span> <span class='ivar'>@user</span><span class='period'>.</span><span class='id identifier rubyid_carrier'>carrier</span> <span class='op'>==</span> <span class='const'>Text</span><span class='op'>::</span><span class='const'>SPRINT</span><span class='rparen'>)</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_sprintSMS'>sprintSMS</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span> <span class='op'>&gt;</span> <span class='int'>160</span>

    <span class='const'>TwilioHelper</span><span class='period'>.</span><span class='id identifier rubyid_new_sprint_long_sms'>new_sprint_long_sms</span><span class='lparen'>(</span><span class='id identifier rubyid_sprintSMS'>sprintSMS</span><span class='comma'>,</span> <span class='id identifier rubyid_user_phone'>user_phone</span><span class='rparen'>)</span>
  
  <span class='kw'>else</span>

    <span class='kw'>if</span> <span class='ivar'>@user</span> <span class='op'>==</span> <span class='kw'>nil</span> <span class='op'>||</span> <span class='ivar'>@user</span><span class='period'>.</span><span class='id identifier rubyid_carrier'>carrier</span> <span class='op'>==</span> <span class='const'>Text</span><span class='op'>::</span><span class='const'>SPRINT</span>
      <span class='id identifier rubyid_msg'>msg</span> <span class='op'>=</span> <span class='id identifier rubyid_sprintSMS'>sprintSMS</span> 
    <span class='kw'>else</span> <span class='comment'>#not Sprint
</span>      <span class='id identifier rubyid_msg'>msg</span> <span class='op'>=</span> <span class='id identifier rubyid_normalSMS'>normalSMS</span> 
    <span class='kw'>end</span> 

    <span class='const'>TwilioHelper</span><span class='period'>.</span><span class='id identifier rubyid_smsSend'>smsSend</span><span class='lparen'>(</span><span class='id identifier rubyid_msg'>msg</span><span class='comma'>,</span> <span class='id identifier rubyid_user_phone'>user_phone</span><span class='rparen'>)</span>

  <span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="new_text_no_wait-class_method">
  
    + (<tt>Object</tt>) <strong>new_text_no_wait</strong>(normalSMS, sprintSMS, user_phone) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Sends a new text without sleeping. Relies on background worker&#39;s  async
call.</p>

<p>Used in NewTextWorker…</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


490
491
492
493
494
495
496
497
498
499
500
501
502
503
504
505
506
507
508
509
510
511</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'helpers/twilio_helper.rb', line 490</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_new_text_no_wait'>new_text_no_wait</span><span class='lparen'>(</span><span class='id identifier rubyid_normalSMS'>normalSMS</span><span class='comma'>,</span> <span class='id identifier rubyid_sprintSMS'>sprintSMS</span><span class='comma'>,</span> <span class='id identifier rubyid_user_phone'>user_phone</span><span class='rparen'>)</span>
  
  <span class='ivar'>@user</span> <span class='op'>=</span> <span class='const'>User</span><span class='period'>.</span><span class='id identifier rubyid_find_by'>find_by</span><span class='lparen'>(</span><span class='label'>phone:</span> <span class='id identifier rubyid_user_phone'>user_phone</span><span class='rparen'>)</span>

  <span class='comment'>#if sprint
</span>  <span class='kw'>if</span> <span class='lparen'>(</span><span class='ivar'>@user</span> <span class='op'>==</span> <span class='kw'>nil</span> <span class='op'>||</span> <span class='ivar'>@user</span><span class='period'>.</span><span class='id identifier rubyid_carrier'>carrier</span> <span class='op'>==</span> <span class='const'>Text</span><span class='op'>::</span><span class='const'>SPRINT</span><span class='rparen'>)</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_sprintSMS'>sprintSMS</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span> <span class='op'>&gt;</span> <span class='int'>160</span>

    <span class='const'>TwilioHelper</span><span class='period'>.</span><span class='id identifier rubyid_new_sprint_long_sms'>new_sprint_long_sms</span><span class='lparen'>(</span><span class='id identifier rubyid_sprintSMS'>sprintSMS</span><span class='comma'>,</span> <span class='id identifier rubyid_user_phone'>user_phone</span><span class='rparen'>)</span>

  <span class='kw'>else</span>

    <span class='kw'>if</span> <span class='ivar'>@user</span> <span class='op'>==</span> <span class='kw'>nil</span> <span class='op'>||</span> <span class='ivar'>@user</span><span class='period'>.</span><span class='id identifier rubyid_carrier'>carrier</span> <span class='op'>==</span> <span class='const'>Text</span><span class='op'>::</span><span class='const'>SPRINT</span>
      <span class='id identifier rubyid_msg'>msg</span> <span class='op'>=</span> <span class='id identifier rubyid_sprintSMS'>sprintSMS</span> 
    <span class='kw'>else</span> <span class='comment'>#not Sprint
</span>      <span class='id identifier rubyid_msg'>msg</span> <span class='op'>=</span> <span class='id identifier rubyid_normalSMS'>normalSMS</span> 
    <span class='kw'>end</span> 

    <span class='const'>TwilioHelper</span><span class='period'>.</span><span class='id identifier rubyid_smsSend'>smsSend</span><span class='lparen'>(</span><span class='id identifier rubyid_msg'>msg</span><span class='comma'>,</span> <span class='id identifier rubyid_user_phone'>user_phone</span><span class='rparen'>)</span>

  <span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="smsRespond-class_method">
  
    + (<tt>Object</tt>) <strong>smsRespond</strong>(body, order) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Wrapper for SMS reply that diverts to testing or Twilio.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


100
101
102
103
104
105
106
107
108
109
110
111</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'helpers/twilio_helper.rb', line 100</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_smsRespond'>smsRespond</span><span class='lparen'>(</span><span class='id identifier rubyid_body'>body</span><span class='comma'>,</span> <span class='id identifier rubyid_order'>order</span><span class='rparen'>)</span>

    <span class='kw'>if</span> <span class='cvar'>@@mode</span> <span class='op'>==</span> <span class='const'>TEST</span>
      <span class='cvar'>@@twiml</span> <span class='op'>=</span> <span class='id identifier rubyid_body'>body</span>
      <span class='cvar'>@@twiml_sms</span><span class='period'>.</span><span class='id identifier rubyid_push'>push</span> <span class='id identifier rubyid_body'>body</span>

    <span class='kw'>elsif</span> <span class='cvar'>@@mode</span> <span class='op'>==</span> <span class='const'>PRO</span> <span class='op'>||</span> <span class='cvar'>@@mode</span> <span class='op'>==</span> <span class='const'>TEST_CRED</span>
      
      <span class='const'>TwilioHelper</span><span class='period'>.</span><span class='id identifier rubyid_smsRespondHelper'>smsRespondHelper</span><span class='lparen'>(</span><span class='id identifier rubyid_body'>body</span><span class='rparen'>)</span>
    <span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="smsRespondHelper-class_method">
  
    + (<tt>Object</tt>) <strong>smsRespondHelper</strong>(body) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Twilio SMS response.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


186
187
188
189
190
191</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'helpers/twilio_helper.rb', line 186</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_smsRespondHelper'>smsRespondHelper</span><span class='lparen'>(</span><span class='id identifier rubyid_body'>body</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_twiml'>twiml</span> <span class='op'>=</span> <span class='const'>Twilio</span><span class='op'>::</span><span class='const'>TwiML</span><span class='op'>::</span><span class='const'>Response</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_r'>r</span><span class='op'>|</span>
        <span class='id identifier rubyid_r'>r</span><span class='period'>.</span><span class='const'>Message</span> <span class='id identifier rubyid_body'>body</span> <span class='comment'>#SEND Text::SPRINT MSG
</span>      <span class='kw'>end</span>
      <span class='id identifier rubyid_twiml'>twiml</span><span class='period'>.</span><span class='id identifier rubyid_text'>text</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="smsSend-class_method">
  
    + (<tt>Object</tt>) <strong>smsSend</strong>(body, user_phone) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Wrapper for new SMS sending (to testing or Twilio)</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


147
148
149
150
151
152
153
154
155
156
157</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'helpers/twilio_helper.rb', line 147</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_smsSend'>smsSend</span><span class='lparen'>(</span><span class='id identifier rubyid_body'>body</span><span class='comma'>,</span> <span class='id identifier rubyid_user_phone'>user_phone</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='cvar'>@@mode</span> <span class='op'>==</span> <span class='const'>TEST</span> <span class='op'>||</span> <span class='cvar'>@@mode</span> <span class='op'>==</span> <span class='const'>TEST_CRED</span>
    <span class='cvar'>@@twiml</span> <span class='op'>=</span> <span class='id identifier rubyid_body'>body</span>
    <span class='cvar'>@@twiml_sms</span><span class='period'>.</span><span class='id identifier rubyid_push'>push</span> <span class='id identifier rubyid_body'>body</span>

    <span class='comment'>#turn on testcred
</span>    <span class='const'>TwilioHelper</span><span class='period'>.</span><span class='id identifier rubyid_testCred'>testCred</span>
  <span class='kw'>end</span>
    <span class='comment'>#for Test_Cred: simulate actual REST api
</span>    <span class='const'>TwilioHelper</span><span class='period'>.</span><span class='id identifier rubyid_smsSendHelper'>smsSendHelper</span><span class='lparen'>(</span><span class='id identifier rubyid_body'>body</span><span class='comma'>,</span> <span class='id identifier rubyid_user_phone'>user_phone</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="smsSendHelper-class_method">
  
    + (<tt>Object</tt>) <strong>smsSendHelper</strong>(body, user_phone) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Twilio send new SMS.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'helpers/twilio_helper.rb', line 220</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_smsSendHelper'>smsSendHelper</span><span class='lparen'>(</span><span class='id identifier rubyid_body'>body</span><span class='comma'>,</span> <span class='id identifier rubyid_user_phone'>user_phone</span><span class='rparen'>)</span>

  <span class='kw'>if</span> <span class='cvar'>@@mode</span> <span class='op'>==</span> <span class='const'>PRO</span>
      <span class='id identifier rubyid_account_sid'>account_sid</span> <span class='op'>=</span> <span class='const'>ENV</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>TW_ACCOUNT_SID</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_auth_token'>auth_token</span> <span class='op'>=</span> <span class='const'>ENV</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>TW_AUTH_TOKEN</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
    <span class='ivar'>@client</span> <span class='op'>=</span> <span class='const'>Twilio</span><span class='op'>::</span><span class='const'>REST</span><span class='op'>::</span><span class='const'>Client</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span> <span class='id identifier rubyid_account_sid'>account_sid</span><span class='comma'>,</span> <span class='id identifier rubyid_auth_token'>auth_token</span>
  <span class='kw'>end</span>

  <span class='ivar'>@client</span><span class='period'>.</span><span class='id identifier rubyid_account'>account</span><span class='period'>.</span><span class='id identifier rubyid_messages'>messages</span><span class='period'>.</span><span class='id identifier rubyid_create'>create</span><span class='lparen'>(</span>
    <span class='symbol'>:body</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_body'>body</span><span class='comma'>,</span>
    <span class='symbol'>:to</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_user_phone'>user_phone</span><span class='comma'>,</span>     <span class='comment'># Replace with your phone number
</span>    <span class='symbol'>:from</span> <span class='op'>=&gt;</span> <span class='cvar'>@@my_twilio_number</span><span class='rparen'>)</span>   <span class='comment'># Replace with your Twilio number
</span>
  <span class='kw'>if</span> <span class='cvar'>@@mode</span> <span class='op'>==</span> <span class='const'>TEST_CRED</span> 
    <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>TC: Sent sms to </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_user_phone'>user_phone</span><span class='embexpr_end'>}</span><span class='tstring_content'>: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_body'>body</span><span class='lbracket'>[</span><span class='int'>10</span><span class='comma'>,</span> <span class='int'>18</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> 
  <span class='kw'>else</span>
    <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Sent sms to </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_user_phone'>user_phone</span><span class='embexpr_end'>}</span><span class='tstring_content'>: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_body'>body</span><span class='lbracket'>[</span><span class='int'>10</span><span class='comma'>,</span> <span class='int'>18</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span> 
  
  <span class='comment'>#turn off testCred
</span>  <span class='const'>TwilioHelper</span><span class='period'>.</span><span class='id identifier rubyid_testCredOff'>testCredOff</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="testCred-class_method">
  
    + (<tt>Object</tt>) <strong>testCred</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Configure and turn on test credentials for higher-fidelity testing.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


72
73
74
75
76
77
78
79
80</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'helpers/twilio_helper.rb', line 72</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_testCred'>testCred</span> 
    <span class='id identifier rubyid_account_sid'>account_sid</span> <span class='op'>=</span> <span class='const'>ENV</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>TEST_TW_ACCOUNT_SID</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_auth_token'>auth_token</span> <span class='op'>=</span> <span class='const'>ENV</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>TEST_TW_AUTH_TOKEN</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>

    <span class='ivar'>@client</span> <span class='op'>=</span> <span class='const'>Twilio</span><span class='op'>::</span><span class='const'>REST</span><span class='op'>::</span><span class='const'>Client</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span> <span class='id identifier rubyid_account_sid'>account_sid</span><span class='comma'>,</span> <span class='id identifier rubyid_auth_token'>auth_token</span>

    <span class='cvar'>@@my_twilio_number</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>+15005550006</span><span class='tstring_end'>&quot;</span></span>
    <span class='cvar'>@@mode</span> <span class='op'>=</span> <span class='const'>TEST_CRED</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="testCredOff-class_method">
  
    + (<tt>Object</tt>) <strong>testCredOff</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Turn off test credentials.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


83
84
85</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'helpers/twilio_helper.rb', line 83</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_testCredOff'>testCredOff</span>
  <span class='cvar'>@@mode</span> <span class='op'>=</span> <span class='const'>ENV</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>RACK_ENV</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="text-class_method">
  
    + (<tt>Object</tt>) <strong>text</strong>(normalSMS, sprintSMS, user_phone) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>API to respond with an SMS</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


363
364
365
366
367
368
369
370
371
372
373
374
375
376
377
378
379
380
381
382
383
384
385
386
387
388
389
390
391
392
393
394
395
396
397
398
399</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'helpers/twilio_helper.rb', line 363</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_text'>text</span><span class='lparen'>(</span><span class='id identifier rubyid_normalSMS'>normalSMS</span><span class='comma'>,</span> <span class='id identifier rubyid_sprintSMS'>sprintSMS</span><span class='comma'>,</span> <span class='id identifier rubyid_user_phone'>user_phone</span><span class='rparen'>)</span>

  <span class='ivar'>@user</span> <span class='op'>=</span> <span class='const'>User</span><span class='period'>.</span><span class='id identifier rubyid_find_by'>find_by</span><span class='lparen'>(</span><span class='label'>phone:</span> <span class='id identifier rubyid_user_phone'>user_phone</span><span class='rparen'>)</span>

  <span class='comment'>#if sprint
</span>  <span class='kw'>if</span> <span class='lparen'>(</span><span class='ivar'>@user</span> <span class='op'>==</span> <span class='kw'>nil</span> <span class='op'>||</span> <span class='ivar'>@user</span><span class='period'>.</span><span class='id identifier rubyid_carrier'>carrier</span> <span class='op'>==</span> <span class='const'>Text</span><span class='op'>::</span><span class='const'>SPRINT</span><span class='rparen'>)</span> <span class='op'>&amp;&amp;</span>
      <span class='id identifier rubyid_sprintSMS'>sprintSMS</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span> <span class='op'>&gt;</span> <span class='int'>160</span>

    <span class='id identifier rubyid_sprintArr'>sprintArr</span> <span class='op'>=</span> <span class='const'>Sprint</span><span class='period'>.</span><span class='id identifier rubyid_chop'>chop</span><span class='lparen'>(</span><span class='id identifier rubyid_sprintSMS'>sprintSMS</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_msg'>msg</span> <span class='op'>=</span> <span class='id identifier rubyid_sprintArr'>sprintArr</span><span class='period'>.</span><span class='id identifier rubyid_shift'>shift</span> <span class='comment'># pop off first element
</span>                <span class='comment'># and send as immediate reply.
</span>
    <span class='comment'># Send all but first SMS asynchronously. 
</span>    <span class='const'>NewTextWorker</span><span class='period'>.</span><span class='id identifier rubyid_perform_in'>perform_in</span><span class='lparen'>(</span><span class='int'>14</span><span class='period'>.</span><span class='id identifier rubyid_seconds'>seconds</span><span class='comma'>,</span>
                   <span class='id identifier rubyid_sprintArr'>sprintArr</span><span class='comma'>,</span>
                   <span class='const'>NewTextWorker</span><span class='op'>::</span><span class='const'>NOT_STORY</span><span class='comma'>,</span>
                   <span class='ivar'>@user</span><span class='period'>.</span><span class='id identifier rubyid_phone'>phone</span><span class='rparen'>)</span>

  <span class='kw'>elsif</span> <span class='ivar'>@user</span> <span class='op'>==</span> <span class='kw'>nil</span> <span class='op'>||</span> <span class='ivar'>@user</span><span class='period'>.</span><span class='id identifier rubyid_carrier'>carrier</span> <span class='op'>==</span> <span class='const'>Text</span><span class='op'>::</span><span class='const'>SPRINT</span>
    <span class='id identifier rubyid_msg'>msg</span> <span class='op'>=</span> <span class='id identifier rubyid_sprintSMS'>sprintSMS</span> 
  <span class='kw'>else</span>
    <span class='id identifier rubyid_msg'>msg</span> <span class='op'>=</span> <span class='id identifier rubyid_normalSMS'>normalSMS</span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='lparen'>(</span><span class='cvar'>@@mode</span> <span class='op'>==</span> <span class='const'>TEST</span> <span class='op'>||</span> <span class='cvar'>@@mode</span> <span class='op'>==</span> <span class='const'>TEST_CRED</span><span class='rparen'>)</span> <span class='op'>&amp;&amp;</span> <span class='lparen'>(</span><span class='lparen'>(</span><span class='ivar'>@user</span> <span class='op'>==</span> <span class='kw'>nil</span> <span class='op'>||</span> <span class='ivar'>@user</span><span class='period'>.</span><span class='id identifier rubyid_carrier'>carrier</span> <span class='op'>==</span> <span class='const'>Text</span><span class='op'>::</span><span class='const'>SPRINT</span><span class='rparen'>)</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_sprintSMS'>sprintSMS</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span> <span class='op'>&gt;</span> <span class='int'>160</span><span class='rparen'>)</span>
    <span class='const'>NewTextWorker</span><span class='period'>.</span><span class='id identifier rubyid_drain'>drain</span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='ivar'>@user</span> <span class='op'>==</span> <span class='kw'>nil</span>
      <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Sent full to new user</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>else</span>
    <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Sent sms to </span><span class='embexpr_beg'>#{</span><span class='ivar'>@user</span><span class='period'>.</span><span class='id identifier rubyid_phone'>phone</span><span class='embexpr_end'>}</span><span class='tstring_content'>: </span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\&quot;</span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_msg'>msg</span><span class='lbracket'>[</span><span class='int'>10</span><span class='comma'>,</span><span class='int'>18</span><span class='rbracket'>]</span> <span class='op'>+</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>...\&quot;</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
  
  <span class='const'>TwilioHelper</span><span class='period'>.</span><span class='id identifier rubyid_smsRespond'>smsRespond</span><span class='lparen'>(</span><span class='id identifier rubyid_msg'>msg</span><span class='comma'>,</span> <span class='const'>LAST</span><span class='rparen'>)</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="text_and_mms-class_method">
  
    + (<tt>Object</tt>) <strong>text_and_mms</strong>(body, mms_url, user_phone) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>API to respond with a joint SMS - MMS</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


332
333
334
335
336
337
338
339
340
341
342
343</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'helpers/twilio_helper.rb', line 332</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_text_and_mms'>text_and_mms</span><span class='lparen'>(</span><span class='id identifier rubyid_body'>body</span><span class='comma'>,</span> <span class='id identifier rubyid_mms_url'>mms_url</span><span class='comma'>,</span> <span class='id identifier rubyid_user_phone'>user_phone</span><span class='rparen'>)</span>

<span class='ivar'>@user</span> <span class='op'>=</span> <span class='const'>User</span><span class='period'>.</span><span class='id identifier rubyid_find_by'>find_by</span><span class='lparen'>(</span><span class='label'>phone:</span> <span class='id identifier rubyid_user_phone'>user_phone</span><span class='rparen'>)</span>

<span class='kw'>if</span> <span class='ivar'>@user</span> <span class='op'>==</span> <span class='kw'>nil</span>
    <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Sent full to new user</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>else</span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Sent full to </span><span class='embexpr_beg'>#{</span><span class='ivar'>@user</span><span class='period'>.</span><span class='id identifier rubyid_phone'>phone</span><span class='embexpr_end'>}</span><span class='tstring_content'>}</span><span class='tstring_end'>&quot;</span></span> 
  <span class='kw'>end</span>

  <span class='const'>TwilioHelper</span><span class='period'>.</span><span class='id identifier rubyid_fullRespond'>fullRespond</span><span class='lparen'>(</span><span class='id identifier rubyid_body'>body</span><span class='comma'>,</span> <span class='id identifier rubyid_mms_url'>mms_url</span><span class='comma'>,</span> <span class='const'>LAST</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

    <div id="footer">
  Generated on Thu Jan 14 00:12:08 2016 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.8.7.6 (ruby-2.1.5).
</div>

  </body>
</html>